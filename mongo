from "Orders" select ShipTo, Lines[].ProductName as ProductNames


Example IV - Projection with calculations:

from "Orders" as x 
select { 
TotalProducts: x.Lines.length, 
TotalDiscountedProducts: x.Lines.filter(x => x.Discount > 0).length, 
TotalPrice: x.Lines.map(l =>l.PricePerUnit * l.Quantity).reduce((a, b) => a + b, 0) 
}

Example VI - Projecting using a loaded document: Loading from many documents 

from "Orders" as o load o.Company as c select { 	CompanyName: c.Name, 	ShippedAt: o.ShippedAt }

Projection using metadata:

from "Employees" as e select { Name: e.FirstName, Metadata: getMetadata(e) }




Projection using function 
declare function output(x) {
    let format = p => p.FirstName + " " + p.LastName;
    return { FullName: format(x) };
}
from "Employees" as e
select output(e)

======================================================

Distinct selection 

from Orders 
select distinct ShipTo.Country

======================================================

from "Employees" as e
where intersect( e.FirstName =="Anne", e.LastName =="Dodsworth")
select e.FirstName, e.LastName

=====================================================

from "Products" select suggest(Name, $p0){ "p0" : ["chokolade"] }

======================================================
GROUP BY: 

========================================================
from "Orders" as o
group by o.ShipTo.City
select 
   o.ShipTo.City as Country,
   sum(o.Lines[].Quantity) as TotalNumberOfOrders

========================================================
from "Orders" as o
group by o.Company, o.Employee
select 
    o.Company,
    o.Employee,
    count() as C
========================================================

from Orders 
group by Employee, Company
select key() as EmployeeCompanyPair, Employee, Company ,count()

========================================================
from Orders 
group by Lines[].ProductName
select Lines[].ProductName as p, count()

=========================================================

from Orders 
group by Lines[].Product, ShipTo.Country 
select Lines[].Product as Product, ShipTo.Country as Country, count()

=========================================================

Spatial Query (showing on the map)

from Employees
where spatial.within(
    spatial.point(Address.Location.Latitude, Address.Location.Longitude),
    spatial.circle(20, 47.623473, -122.3060097)
)

=========================================================


Filter by field path 



Start of indexing : 

This returns employees by first and last name 
map('Employees', function(Emp){
      return {
          FullName: Emp.FirstName + " "+Emp.LastName    
      };
});


In this example, the index field Query combines all values from various Employee fields into one.

map('Employees', function (employee) { 
return { 
    Query : [employee.FirstName, 
             employee.LastName,
             employee.Title,
             employee.Address.City] 
        } 
})

The search is where search(Query, “value”)


=======================================================================

from company in docs.Companies
   where company.Address.Location.Latitude > 20 && company.Address.Location.Latitude < 50
   select new
   {
       latitude = company.Address.Location.Latitude,
       longitude = company.Address.Location.Latitude,
       companyName = company.Name,
       companyAddress = company.Address,
       companyPhone = company.Phone
   };

========================================================================

map('products', function(p){
    return {
        Category: load(p.Category, 'Categories').Name,
        Count: 1
    }
})

======
groupBy(x => x.Category).aggregate(g => {
    return {
        Category: g.key,
        Count: g.values.reduce((count, val) => val.Count + count, 0)
    };
})

=================================================================
Map:

from o in docs.Orders
from line in o.Lines
select new{
    Product = line.Product,
    Count = 1,
    TotalSold = ((line.Quantity * line.PricePerUnit) *(1-line.Discount))
}

=======
Reduce:
from r in results 
group r by r.Product into g
select new{
         Product = g.Key,
         Count = g.Sum(x=>x.Count),
         TotalSold = g.Sum(x=>x.TotalSold)
}

=======================================================================
